<template>
    <lightning-card title="Property Inspections">
        
        <div class="slds-p-around_medium slds-text-align_center">
            <template if:true={averageRating}>
                <div class="slds-text-heading_large">
                    ‚≠ê {averageRating}
                </div>
                <div class="slds-text-title">Average Rating</div>
            </template>
            <template if:false={averageRating}>
                <div class="slds-text-color_weak">
                    No rating available
                </div>
            </template>
        </div>
      
        <div class="slds-grid slds-gutters slds-p-horizontal_medium">
            <lightning-combobox
                label="Status"
                value={statusFilter}
                options={statusOptions}
                onchange={handleStatusChange}>
            </lightning-combobox>

            <lightning-combobox
                label="Type"
                value={typeFilter}
                options={typeOptions}
                onchange={handleTypeChange}>
            </lightning-combobox>
        </div>
        
        <div class="slds-p-around_medium">
            <lightning-button
                label="Schedule New Inspection"
                variant="brand"
                onclick={launchFlow}>
            </lightning-button>
        </div>
        
        <template if:true={inspections.length}>
            <div class="slds-p-around_medium">
                <table class="slds-table slds-table_bordered">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Rating</th>
                            <th>Inspector</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={inspections} for:item="i">
                            <tr key={i.Id}>
                                <td>{i.Inspection_Date__c}</td>
                                <td>{i.Inspection_Type__c}</td>
                                <td>
                                    <span class={i.statusClass}>
                                        {i.Inspection_Status__c}
                                    </span>
                                </td>
                                <td>{i.Overall_Rating__c}</td>
                                <td>{i.Inspector_Name__c}</td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </template>

        <template if:false={inspections.length}>
            <div class="slds-p-around_medium slds-text-align_center slds-text-color_weak">
                No inspections found
            </div>
        </template>
    </lightning-card>
    
    <template if:true={showFlow}>
        <section role="dialog" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <h2 class="slds-text-heading_medium">
                        Schedule Inspection
                    </h2>
                </header>

                <div class="slds-modal__content slds-p-around_medium">
                    <lightning-flow
                        flow-api-name="Schedule_Property_Inspection"
                        flow-input-variables={flowInputVariables}
                        onstatuschange={handleFlowStatus}>
                    </lightning-flow>
                </div>                
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
</template>
